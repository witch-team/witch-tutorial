<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>witch-tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">witch-tutorial</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#manual-for-the-sorcerers-apprentice" id="toc-manual-for-the-sorcerers-apprentice" class="nav-link active" data-scroll-target="#manual-for-the-sorcerers-apprentice">Manual for the sorcerer’s apprentice</a>
  <ul class="collapse">
  <li><a href="#tools-add-something-to-the-path" id="toc-tools-add-something-to-the-path" class="nav-link" data-scroll-target="#tools-add-something-to-the-path">Tools: add something to the Path</a>
  <ul class="collapse">
  <li><a href="#add-to-environment-variables-in-windows" id="toc-add-to-environment-variables-in-windows" class="nav-link" data-scroll-target="#add-to-environment-variables-in-windows">Add to Environment Variables in Windows</a></li>
  <li><a href="#add-to-path-in-macos" id="toc-add-to-path-in-macos" class="nav-link" data-scroll-target="#add-to-path-in-macos">Add to $PATH in MacOS</a></li>
  </ul></li>
  <li><a href="#install-software" id="toc-install-software" class="nav-link" data-scroll-target="#install-software">Install software</a>
  <ul class="collapse">
  <li><a href="#homebrew-for-macos" id="toc-homebrew-for-macos" class="nav-link" data-scroll-target="#homebrew-for-macos">Homebrew for MacOS</a></li>
  <li><a href="#gams-installation" id="toc-gams-installation" class="nav-link" data-scroll-target="#gams-installation">GAMS installation</a></li>
  <li><a href="#install-r" id="toc-install-r" class="nav-link" data-scroll-target="#install-r">Install R</a></li>
  <li><a href="#install-git" id="toc-install-git" class="nav-link" data-scroll-target="#install-git">Install Git</a></li>
  <li><a href="#install-vs-code" id="toc-install-vs-code" class="nav-link" data-scroll-target="#install-vs-code">Install VS Code</a></li>
  <li><a href="#install-open-vpn" id="toc-install-open-vpn" class="nav-link" data-scroll-target="#install-open-vpn">Install Open VPN</a></li>
  <li><a href="#install-the-ubuntu-subsystem-necessary-only-on-windows" id="toc-install-the-ubuntu-subsystem-necessary-only-on-windows" class="nav-link" data-scroll-target="#install-the-ubuntu-subsystem-necessary-only-on-windows">Install the Ubuntu subsystem (Necessary only on Windows)</a></li>
  <li><a href="#github-instructions" id="toc-github-instructions" class="nav-link" data-scroll-target="#github-instructions">GitHub Instructions</a></li>
  </ul></li>
  <li><a href="#run-witch-for-the-first-time" id="toc-run-witch-for-the-first-time" class="nav-link" data-scroll-target="#run-witch-for-the-first-time">Run WITCH for the first time</a>
  <ul class="collapse">
  <li><a href="#what-if-witch-calibration-does-not-converge" id="toc-what-if-witch-calibration-does-not-converge" class="nav-link" data-scroll-target="#what-if-witch-calibration-does-not-converge">What if WITCH calibration does not converge?</a></li>
  <li><a href="#adding-data-to-witchrice" id="toc-adding-data-to-witchrice" class="nav-link" data-scroll-target="#adding-data-to-witchrice">Adding data to WITCH/RICE</a></li>
  </ul></li>
  <li><a href="#useful-commands-and-debug" id="toc-useful-commands-and-debug" class="nav-link" data-scroll-target="#useful-commands-and-debug">Useful commands and debug</a>
  <ul class="collapse">
  <li><a href="#local-witch-translate-and-witch-plot" id="toc-local-witch-translate-and-witch-plot" class="nav-link" data-scroll-target="#local-witch-translate-and-witch-plot">Local: witch-translate and witch-plot</a></li>
  <li><a href="#git" id="toc-git" class="nav-link" data-scroll-target="#git">Git</a></li>
  <li><a href="#bash" id="toc-bash" class="nav-link" data-scroll-target="#bash">Bash</a></li>
  <li><a href="#zeus" id="toc-zeus" class="nav-link" data-scroll-target="#zeus">Zeus</a></li>
  </ul></li>
  <li><a href="#how-to-add-new-insights-to-witch-tutorial" id="toc-how-to-add-new-insights-to-witch-tutorial" class="nav-link" data-scroll-target="#how-to-add-new-insights-to-witch-tutorial">How to add new insights to witch-tutorial</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">witch-tutorial</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="manual-for-the-sorcerers-apprentice" class="level1">
<h1>Manual for the sorcerer’s apprentice</h1>
<p>Please find <a href="https://drive.google.com/drive/folders/1ifQP_E3w6_pJc-g7ObihBMmsaVPMMJl8?usp=share_link">here</a>:</p>
<ul>
<li>Models: base versions of DICE and RICE50x</li>
<li>Slides on GAMS and IAMs</li>
<li>Videos of lectures on GAMS and IAMs</li>
</ul>
<section id="tools-add-something-to-the-path" class="level2">
<h2 class="anchored" data-anchor-id="tools-add-something-to-the-path">Tools: add something to the Path</h2>
<section id="add-to-environment-variables-in-windows" class="level3">
<h3 class="anchored" data-anchor-id="add-to-environment-variables-in-windows">Add to Environment Variables in Windows</h3>
<p>To add a program to the PATH, search in Windows for environment variables and click on the button “Environment Variables” at the bottom of the window that opens up (should be the window of Sytem properties &gt; Advanced tab). Under “User variables” select the “Path” option end edit it; click “New” and paste the address of the folder of the specific software you want to add. This is the address of the <em>.exe</em> file of the program; it is usually found in the main folder of the program or in the bin folder.</p>
</section>
<section id="add-to-path-in-macos" class="level3">
<h3 class="anchored" data-anchor-id="add-to-path-in-macos">Add to $PATH in MacOS</h3>
<p>You can check what is already in your $PATH by running</p>
<pre><code>echo $PATH</code></pre>
<p>If the program you’re interested in is not already present, you need to add it. Depending on the macOS version you’re running on your Mac, this can be done via either the bash shell or zsh (z shell). - For older macOS versions (before Catalina): bash (.bashrc or .bash_profile) - For macOS Catalina and later: zsh (.zshrc or .zprofile) You need to edit the right file</p>
<pre><code>vim ~/.zprofile</code></pre>
<p>OR</p>
<pre><code>open ~/.zprofile</code></pre>
<p>by adding</p>
<pre><code>   export $PATH:/path/to/directory</code></pre>
</section>
</section>
<section id="install-software" class="level2">
<h2 class="anchored" data-anchor-id="install-software">Install software</h2>
<section id="homebrew-for-macos" class="level3">
<h3 class="anchored" data-anchor-id="homebrew-for-macos">Homebrew for MacOS</h3>
<p>Homebrew provides a fast way to install programs in MacOS. Learn how to install it from here: <a href="https://brew.sh" class="uri">https://brew.sh</a></p>
</section>
<section id="gams-installation" class="level3">
<h3 class="anchored" data-anchor-id="gams-installation">GAMS installation</h3>
<p>You can always download the latest distribution at <a href="https://www.gams.com/download" class="uri">https://www.gams.com/download</a> Please make sure to read the release notes <a href="https://www.gams.com/latest/docs/RN_MAIN.html" class="uri">https://www.gams.com/latest/docs/RN_MAIN.html</a></p>
<p>If you are installing GAMS from scratch, select in the installation process “Browse for a license file” and select gamslice.txt. If you are updating the license, copy the six lines (from the gamslice.txt file - someone should give it to you) to the clipboard. Then, open GAMS Studio and click on “Help &gt; GAMS Licensing” or “Help &gt; About GAMS”, depending on your version of GAMS Studio. A message box will notify you that a GAMS license has been found on the clipboard. If ‘Yes’ is clicked, the new license will be installed automatically and presented via the “About GAMS” dialog. For more detailed installation instructions, please visit: <a href="https://www.gams.com/latest/docs/UG_MAIN.html#UG_INSTALL" class="uri">https://www.gams.com/latest/docs/UG_MAIN.html#UG_INSTALL</a> The full system documentation is provided electronically with the software and also available online at <a href="https://www.gams.com/latest/docs" class="uri">https://www.gams.com/latest/docs</a></p>
<p>Include GAMS in your environment variables. Add the address path of the version you are currently working with. To check if this worked properly, open Windows Command Prompt, type <code>gams</code> and see if it is recognized. (You can do the same thing in Terminal in MacOS)</p>
</section>
<section id="install-r" class="level3">
<h3 class="anchored" data-anchor-id="install-r">Install R</h3>
<p>Install the latest version of R and of RStudio. Install Rtools <a href="https://cran.rstudio.com/bin/windows/Rtools/" class="uri">https://cran.rstudio.com/bin/windows/Rtools/</a> and add it to the environment variables (the bin folder, as in <code>C:/rtools42/mingw64/bin</code>).</p>
</section>
<section id="install-git" class="level3">
<h3 class="anchored" data-anchor-id="install-git">Install Git</h3>
<p>Download Git for Windows <a href="https://git-scm.com/download/win" class="uri">https://git-scm.com/download/win</a>. Install also GitKraken or GitHub Desktop. Add the latter(s) to the environment variables. Remember that if you are a student, you can ask for a student pro account of GitHub; using this to log into GitKraken allows you to download the full version.</p>
<p>For MacOS you can use homebrew</p>
<pre><code>brew install git</code></pre>
</section>
<section id="install-vs-code" class="level3">
<h3 class="anchored" data-anchor-id="install-vs-code">Install VS Code</h3>
<p>After having downloaded Visual Studio Code, install the “gms” extension to visualize correctly colors in GAMS.</p>
</section>
<section id="install-open-vpn" class="level3">
<h3 class="anchored" data-anchor-id="install-open-vpn">Install Open VPN</h3>
<p>In order to have access to the Zeus Cluster you need a VPN server, which can be obtained through the client Open VPN. You can install it for <a href="https://openvpn.net/client-connect-vpn-for-mac-os/">Mac OS X</a> and for <a href="https://openvpn.net/client-connect-vpn-for-windows/">Windows</a> following the instructions. You need a licence to use it, which you can ask to the IT team (refer to nicola.sanavio@cmcc.it). They will provide you a link to a shared Google Drive folder where you will find a folder called scc-dmw vpn containing your licence. You will have to download it and extract it, then follow the instructions that appear when you first open Open VPN.</p>
<ul>
<li>Open “OpenVPN Connect” program.</li>
<li>Click to Tab “File”</li>
<li>Drag and drop your file configuration or browse (should be a .OVPN file)</li>
<li>Set your profile name and click to add</li>
<li>Everything should run</li>
</ul>
</section>
<section id="install-the-ubuntu-subsystem-necessary-only-on-windows" class="level3">
<h3 class="anchored" data-anchor-id="install-the-ubuntu-subsystem-necessary-only-on-windows">Install the Ubuntu subsystem (Necessary only on Windows)</h3>
<p>On Windows it is suggested to install it directly from Microsoft Store. Look for Windows Subsystem for Linux or WSL and press “install”. When this is over open Windows Terminal and type</p>
<pre><code>wsl --install</code></pre>
<p>It will open a list of different distribution that you can choose. If you go for Ubuntu you should write <code>wsl --install -d Ubuntu</code>. At the end of the process it should open a Ubuntu window, then ask you for a username and a password for your account (remember them!).</p>
<p>Install <a href="https://ubuntu.com/tutorials/install-ubuntu-on-wsl2-on-windows-10#1-overview" class="uri">https://ubuntu.com/tutorials/install-ubuntu-on-wsl2-on-windows-10#1-overview</a></p>
</section>
<section id="github-instructions" class="level3">
<h3 class="anchored" data-anchor-id="github-instructions">GitHub Instructions</h3>
<p><a href="https://github.com/witch-team/witch" class="uri">https://github.com/witch-team/witch</a></p>
</section>
</section>
<section id="run-witch-for-the-first-time" class="level2">
<h2 class="anchored" data-anchor-id="run-witch-for-the-first-time">Run WITCH for the first time</h2>
<ol type="1">
<li>Clone the <code>witch</code> and the <code>witch-data</code> repositories
<ul>
<li><code>git clone git@github.com:witch-team/witch.git</code></li>
<li><code>cd witch</code> (enter in the new folder with the clone)</li>
<li><code>git checkout branchname</code></li>
</ul></li>
<li>Following the instructions in the READme in witch-data, install dvc in the WSL2 subsystem and dvc pull all the files in the witch-data folder</li>
<li>Again in WSL2, move in the witch folder and run <code>dvc pull</code></li>
<li>Open RStudio, set the working directory in the witch folder, and run input/translate_witch_data</li>
<li>Open GAMStudio or GAMS IDE and run witch</li>
</ol>
<p>Easier alternative:</p>
<ol type="1">
<li>Clone the <code>witch</code> repository</li>
<li>Launch <code>make</code> from the terminal</li>
</ol>
<section id="what-if-witch-calibration-does-not-converge" class="level3">
<h3 class="anchored" data-anchor-id="what-if-witch-calibration-does-not-converge">What if WITCH calibration does not converge?</h3>
<p>Sometimes if there has been some structural change or variable names have been changed, the model can take too much time to converge in it calibration. This is because the starting points are too distant to the solution and the solver takes too much time to converge. The convergence algorithm of the dynamic calibration is not working very well sometimes, in particular if some big changes are done with new variables and new interactions. Usually, we solve this convergence problem, by stopping the calibration and restarting it with another starting point than the one provided by default to find a better one. A good choice for the new starting point is the <code>all_data_temp.gdx</code> after few iterations. Then relaunch the calibration with the parameter <code>- -startgdx</code>:</p>
<pre><code>bsub -q p_gams -n 18 -R "span[ptile=18]" -P R000 -J data_witch17/results_ssp2_calib.gdx -K gams run_witch.gms output=ssp2_calib.lst --calibration=1 gdxcompress=1 --n=witch17 --verbose=1 errmsg=1 --startgdx=all_data_temp_ssp2_calib --startboost=1</code></pre>
<p>Once you manage to converge, you should commit the new starting point using the files generated by the calibration:</p>
<pre><code>results_ssp2_bau.gdx
data_witch17/data_tfp_ssp2.gdx</code></pre>
<p>Overwrite the files in input/data (postfixed by the regional aggregation):</p>
<pre><code>cp data_witch17/data_tfp_ssp2.gdx input/data/data_tfp_ssp2_witch17.gdx
cp results_ssp2_bau.gdx input/data/data_results_ssp2_bau_witch17.gdx</code></pre>
<p>Update the information for dvc and commit it in your branch</p>
<pre><code>dvc add input/data/data_tfp_ssp2_witch17.gdx input/data/data_results_ssp2_bau_witch17.gdx
git add input/data/data_tfp_ssp2_witch17.gdx.dvc input/data/data_results_ssp2_bau_witch17.gdx.dvc 
git commit -m "update starting points"
</code></pre>
<p>Don’t forget to push the files to the DVC remote drive and then the git commit</p>
<pre><code>dvc push
git push</code></pre>
</section>
<section id="adding-data-to-witchrice" class="level3">
<h3 class="anchored" data-anchor-id="adding-data-to-witchrice">Adding data to WITCH/RICE</h3>
<ol type="1">
<li><p>witch-data</p>
<ul>
<li>Create an R script that processes the raw data and creates a long csv with column names iso3, year, variable, value</li>
<li>Put the R script and the source files in a dedicated folder in witch-data. Open the R project <code>witch-datasets.Rproj</code> and run your R script. Let it create the output file</li>
<li>Open the terminal, go in the local folder and do <code>dvc add</code> for the input and the output files. A message will be displayed saying to do git add those files.</li>
<li><code>git commit</code> the files just added and <code>git push</code> them</li>
<li>In the terminal, go in the witch-data folder and do <code>dvc push</code>. You need to have access to the ‘remote drive’</li>
</ul></li>
<li><p>make and translate witch data</p>
<ul>
<li>Copy-paste the <code>.csv</code> file inside <code>witch/input/data</code></li>
<li>Open the terminal, go in the local folder and do <code>dvc add</code> for the <code>.csv</code> file. A message will be displayed saying to <code>git add</code> those files.</li>
<li><code>git commit</code> the files just added and <code>git push</code> them</li>
<li>Create a <code>make_data.R</code> script</li>
<li>In the terminal, from the witch folder, run</li>
</ul>
<pre><code>Rscript input/translate_witch_data.R --dvc-single</code></pre>
<p>Running <code>translate\_witch\_data.R</code> from Rstudio might return a dvc error. If it says a specific folder is not editable, run it by writing <code>sudo</code> before.</p>
<ul>
<li>If there is an error because one file is not found, go inside the <code>input/data</code> directory from the terminal and run <code>dvc pull [filename.ext].dvc</code>, i.e.&nbsp;writing .dvc after its own extension</li>
</ul></li>
<li><p>witch. Load the files in a gams file and work with them</p></li>
</ol>
</section>
</section>
<section id="useful-commands-and-debug" class="level2">
<h2 class="anchored" data-anchor-id="useful-commands-and-debug">Useful commands and debug</h2>
<ul>
<li><p>Operations to clone witch and start working in an existing branch</p>
<ul>
<li><code>git clone git@github.com:witch-team/witch.git</code></li>
<li><code>cd witch</code> (enter in the new folder with the clone)</li>
<li><code>git checkout branchname</code></li>
<li><code>dvc pull</code> (while in input/data). If it asks you for an authorization code and pasting the code in the browser yields an error, skip directly to the next point</li>
<li><code>make</code></li>
</ul></li>
<li><p>If you need to pull a commit from GitHub do</p>
<ul>
<li><p><code>git pull</code></p></li>
<li><p><code>make clean</code> (this will remove old data files)</p></li>
<li><p><code>make</code> (to run all)</p>
<ul>
<li><code>make data</code> (if you just want to translate WITCH data into usable files)</li>
<li><code>make -B data</code> (useful if you just want to re translate one file, with -B you force the operation)</li>
</ul></li>
</ul></li>
<li><p>DVC pull fix error. When doing <code>dvc pull</code> and receiving the error: <code>Is your cache up to date? &lt;https://error.dvc.org/missing-files&gt;</code> loop through every single file in the folder input/data and <code>dvc pull</code> them singularly to have the same result without any error.</p>
<ul>
<li>In bash: <code>for FILE in *.dvc; do dvc pull $FILE; done</code>
<ul>
<li>In case there are subfolders, run the following: <code>for DIR in */;do for FILE in $DIR*.dvc; do dvc pull $FILE; done; done;</code></li>
</ul></li>
<li>In Windows: <code>FOR %i IN (*.dvc) DO dvc pull %i</code></li>
</ul></li>
</ul>
<section id="local-witch-translate-and-witch-plot" class="level3">
<h3 class="anchored" data-anchor-id="local-witch-translate-and-witch-plot">Local: witch-translate and witch-plot</h3>
<ul>
<li>Error: <code>Error in gdxInfo(filename, dump = F, returnDF = T):</code> <code>Error loading the GDX API: use igdx() to diagnose and solve the problem</code>
<ul>
<li>Solution: first launch <code>igdx()</code> in the console, it should return: <code>The GDX library has not been loaded</code>. Then try <code>igdx(gams_path)</code>, where <code>gams_path</code> is the path of the GAMS <em>.exe</em> file. If it says the library has been loaded, include this last line at the beginning of the code</li>
</ul></li>
<li>Error: <code>Warning in install.packages: package ‘taRifx’ is not available for this version of R</code>
<ul>
<li>Solution: <code>remotes::install_version(package="taRifx",version="1.0.6.2")</code></li>
</ul></li>
</ul>
</section>
<section id="git" class="level3">
<h3 class="anchored" data-anchor-id="git">Git</h3>
<ul>
<li>Initialize an existing directory as a Git repository: <code>git init</code></li>
<li>Check if the files are up to date: <code>git status</code></li>
<li>Select a branch <code>git checkout</code></li>
<li>Check the differences between local and remote: <code>git diff</code></li>
<li>Check the difference of what is staged but not yet committed: <code>git diff --staged</code></li>
<li>Merge the specified branch’s history into the current one: <code>git merge [branch]</code></li>
<li>Stash the current work - i.e.&nbsp;save it for later use. E.g. you might have done edits on Zeus and want to pull other edits you made on your machine and committed from there <code>git stash</code>
<ul>
<li>To see the last stash: <code>git stash show -p</code></li>
<li>Different stashes can be addressed by: <code>stash@{0}</code>, where <code>0</code> is the default one</li>
<li>To see the differences between your stashed changes and any branch: <code>git diff stash@{0} branchname</code></li>
<li>Apply the stashed changes: <code>git stash pop</code></li>
<li>Clean all your stashes: <code>git stash clear</code></li>
</ul></li>
</ul>
</section>
<section id="bash" class="level3">
<h3 class="anchored" data-anchor-id="bash">Bash</h3>
<ul>
<li><p>Move between folders: <code>cd</code></p>
<ul>
<li><code>cd/..</code> to go back one folder</li>
</ul></li>
<li><p>View the content a file: <code>cat</code></p></li>
<li><p>View the end of a file: <code>tail</code></p></li>
<li><p>List files in a folder: <code>ls</code></p>
<ul>
<li><code>-ltrh</code> order by most recent and display last edit</li>
</ul></li>
<li><p>Move a file: <code>mv</code></p></li>
<li><p>Change a name: <code>mv [old_name] [new_name]</code></p></li>
<li><p>Copy a file: <code>cp</code></p></li>
<li><p>Remove a file: <code>rm</code></p></li>
<li><p>Remove a directory if empty: <code>rmdir [directory_name]</code></p></li>
<li><p>To remove non empty directory</p>
<ul>
<li><code>-r</code> when selecting a folder, remove also all subfolders so you could do <code>rm -r [directory_name]</code></li>
<li>If this does not work, first remove all the filese inside: <code>rm [directory_name]/*</code></li>
<li>Then remove the empty directory: <code>rmdir [directory_name]</code></li>
<li>Sometimes it works with: <code>rm -rf [directory_name]</code></li>
</ul></li>
<li><p>Open a file: <code>vim</code></p>
<ul>
<li>Move freely within the doc with arrow keys</li>
<li>To enter insert mode (i.e.&nbsp;edit) press <code>i</code></li>
<li>Close the file: <code>:q</code>
<ul>
<li>Discard changes you made: <code>:q!</code></li>
<li>Write changes you made: <code>:wq</code></li>
</ul></li>
</ul></li>
<li><p>Date and time of last edit of a file: <code>stat -c %y [filename]</code></p></li>
</ul>
</section>
<section id="zeus" class="level3">
<h3 class="anchored" data-anchor-id="zeus">Zeus</h3>
<section id="base-commands" class="level4">
<h4 class="anchored" data-anchor-id="base-commands">Base commands</h4>
<ul>
<li>Translate_witch_data on Zeus</li>
</ul>
<p>First you make sure that you have everything up to date with <code>git pull</code>, then you can run</p>
<pre><code>    Rscript input/translate_witch_data.R --dvc-single
    </code></pre>
<p>If Zeus ask you to open an external link you can’t do it because it’s not in your local server, so something went wrong. It could be that you have some credential file in your folder that you need to remove. Look for user_credential files with <code>ls</code>, then remove them with <code>rm {file_name}</code>. After this procedure you could be able to run translate_witch_data.R with</p>
<pre><code>    Rscript input/translate_witch_data.R</code></pre>
<p>or</p>
<pre><code>    Rscript input/translate_witch_data.R --dvc-single
    </code></pre>
<ul>
<li>Run WITCH on Zeus</li>
</ul>
<pre><code>    bsub -n 18 -R "span[ptile=18]" -q p_gams -P 0477 gams run_witch.gms</code></pre>
<ul>
<li><p>See the output of the run: <code>bpeek</code></p>
<ul>
<li>See only the last part of the output of the run <code>-f</code></li>
</ul></li>
<li><p>See the list of active jobs: <code>bjobs</code></p></li>
<li><p>Kill a job: <code>bkill</code></p>
<ul>
<li>All: <code>bkill 0</code></li>
<li>By ID: <code>bkill [jobid]</code></li>
</ul></li>
<li><p>Commit on zeus</p></li>
</ul>
<p>From the repository on zeus, add the edited files in the remote repository with <code>git add modules/[edited_file_name]</code></p>
<p>Commit the changes to the remote repository with an explanatory message <code>git commit -m "[descriptive_message]"</code></p>
<p>Finish with <code>git push</code></p>
</section>
<section id="manage-files" class="level4">
<h4 class="anchored" data-anchor-id="manage-files">Manage files</h4>
<ul>
<li><p>Manually copy one (or more) files from/to Zeus:</p>
<ul>
<li>Zeus address: <code>zeus:/users_home/seme/[user]/work/witch/</code></li>
</ul>
<pre><code>Scp [departure_address\filename] [destination_address/]
scp zeus:/users_home/seme/aa1111/work/witch/results_bau.gdx C:\Users\asdasd\Documents\GitHub\witch</code></pre></li>
<li><p>Update a folder on ZEUS based on the local witch folder: <code>sh sync2zeus.sh</code> (it actually runs: <code>sync -uavzP --exclude=.git --exclude=.Rproj.user --exclude=*.Rproj ../witch zeus:/work/seme/aa1111/witch</code>)</p></li>
</ul>
</section>
<section id="check-and-debug" class="level4">
<h4 class="anchored" data-anchor-id="check-and-debug">Check and debug</h4>
<ul>
<li><p>Open the WITCH error file and refresh it every 2 seconds: <code>watch tail errors_ssp2_calib.txt</code></p>
<ul>
<li>Visualize more than the default number of lines (e.g.&nbsp;40) <code>-n 40</code></li>
<li>Exit with <code>CTRL+C</code></li>
</ul></li>
<li><p>Explore gdx files (e.g.&nbsp;WITCH results) in Zeus</p>
<ul>
<li>If I want to read for example <code>data_validation.gdx</code>, reading all the different items</li>
</ul>
<pre><code> gdxdump data_validation.gdx symbols</code></pre>
<ul>
<li>If I want to explore a specific item</li>
</ul>
<pre><code> gdxdump data_validation.gdx Symb=mcost_inv_valid_irena_csp</code></pre>
<ul>
<li>To search through the results you can add <code>| less</code> at the end in order to move freely in it</li>
</ul>
<pre><code> gdxdump data_validation.gdx Symb=mcost_inv_valid_irena_csp | less</code></pre>
<ul>
<li>You can also filter the data with <code>grep</code>. Example:</li>
</ul>
<pre><code>gdxdump all_data_temp_ssp2_bau.gdx symb=MCOST_INV | grep usa | grep elpc_new | grep '.L ' | less</code></pre></li>
<li><p>Rsyinc while excluding some files</p></li>
</ul>
<pre><code>    rsync -uavzP --exclude=.git --exclude=.Rproj.user --exclude=*.Rproj
    ../witch zeus:/work/seme/aa11111/witch</code></pre>
<ul>
<li>Look for for errors in a <code>.lst</code> file opened with <code>vim</code>: <code>/\*\*\*\*</code></li>
<li>Look for for infeasibilities in a <code>.lst</code> file opened with <code>vim</code>: <code>/INFES</code></li>
<li>Tool to convert a <code>.sh</code> file from <code>dos</code> to <code>unix</code>. Necessary after each Windows edit of the original <code>.sh</code> file. Execute in case of error <code>/bin/sh^M: bad interpreter: No such file or directory</code></li>
</ul>
<pre><code>dos2unix [filename]</code></pre>
</section>
<section id="gams-good-practices-to-avoid-weird-errors" class="level4">
<h4 class="anchored" data-anchor-id="gams-good-practices-to-avoid-weird-errors">GAMS good practices to avoid weird errors</h4>
<ul>
<li>If you can write one equation instead of two, do it. Helps very much the solver</li>
<li>Never go in a new line with a (e.g.&nbsp;multiplicative) <code>*</code>, even if there is a <code>if set [modulename]</code> in front of it</li>
</ul>
</section>
</section>
</section>
<section id="how-to-add-new-insights-to-witch-tutorial" class="level2">
<h2 class="anchored" data-anchor-id="how-to-add-new-insights-to-witch-tutorial">How to add new insights to witch-tutorial</h2>
<p>If you are a pro sorcerer you are ready to add the new info that you think can be useful for the others!</p>
<ul>
<li>Clone the WITCH repository witch-tutorial</li>
<li>Inside the witch-tutorial folder you will find a file named <code>index.qmd</code></li>
<li>Open it in Rstudio and add some new instruction/information</li>
<li>Switch to Source and not visual to see the code where you can write</li>
<li>Please be respectful of the others work, don’t eliminate anything that is needed and try to be short but complete :)</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>